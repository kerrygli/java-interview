## 系统设计

### 1.秒杀系统设计



### 2.分库分表设计
- 主流分表策略：Range范围，hash切分，映射表
  * Range范围按某个字段的数据区间进行切分；
  优点：方便扩容，每次数据量达到range值就新增一张表，通过代码实现自动化扩容；
  缺点：存在写偏移，可能有热点问题。
  
  * Hash切分：通过对分表键进行一定的运算，通过运算结果来决定路由的库和表。
  优点：数据分片均匀，大大降低热点问题；
  缺点：算法选择不合理，后期扩容可能需要迁移数据；数据被切分到不同到库和表中，可能
  存在跨节点查询和分页等问题。

  * 映射表：将分表键和数据库等映射关系记录在一张单独等表中。
  优点：可以灵活设置分表规则；
  缺点：映射表可能随着数据量的增大，同样需要分库和分表，带来更多的问题。

- 分布式id
  * uuid:
  优点：本地生成，性能非常高，没有网络消耗；
  缺点：不易于存储，uuid太长；基于mac地址生成，可能会造成mac地址泄漏；
  * 号段模式：
  优点：可以获取一个id,也可以获取一批id；简单，利用现有数据库系统功能实现；
  缺点：强依赖发号DB的性能，可能有单点问题；
  * 雪花算法：
  优点：毫秒数在高位，自增序列在低位，整个id都是趋势递增；
  缺点：强依赖机器时钟，如果时钟回拨，会到值重复或者服务不可用。

- 分库分表工具
 * 客户端模式：sharding-jdbc

 * 代理模式:MyCat
总结：客户端比较轻量，性能也会比较好；
  代理模式，客户端无需维护服务，但需要额外部署代理服务器，代理服务器到稳定性和性能都需要保障。


- 分库分表方案
  * 冷热数据分离，冷数据可以采用hive，es作为查询；
  订单表通常采用数据冗余的方案，拆分买家库和卖家库两个库，一个订单在买家和卖家库都存储一份。










